<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Analytics - Pulse AI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%); min-height: 100vh; }
        
        /* Navigation */
        nav { background: white; padding: 1rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .nav-container { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 1rem; text-decoration: none; }
        .logo-icon { width: 50px; height: 50px; background: linear-gradient(135deg, #4169E1 0%, #1E90FF 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; }
        .logo-text h1 { font-size: 1.5rem; color: #1a1a1a; }
        .logo-text p { font-size: 0.85rem; color: #666; }
        .nav-links { display: flex; gap: 2rem; align-items: center; }
        .nav-link { display: flex; align-items: center; gap: 0.5rem; text-decoration: none; color: #444; font-weight: 500; transition: color 0.3s; padding: 0.5rem 1rem; border-radius: 8px; }
        .nav-link:hover { color: #4169E1; background: #f0f4ff; }
        .nav-link.active { background: #1a1a1a; color: white; }
        .hamburger { display: none; flex-direction: column; gap: 4px; cursor: pointer; }
        .hamburger span { width: 25px; height: 3px; background: #1a1a1a; border-radius: 2px; transition: 0.3s; }
        
        /* Main Content */
        .main-content { max-width: 1400px; margin: 0 auto; padding: 3rem 2rem; }
        .page-header { text-align: center; margin-bottom: 3rem; }
        .page-header h2 { font-size: 2.5rem; color: #1a1a1a; margin-bottom: 1rem; }
        .page-header p { font-size: 1.1rem; color: #666; max-width: 800px; margin: 0 auto; }
        
        /* Charts Grid */
        .charts-grid { display: grid; grid-template-columns: 1fr; gap: 2rem; }
        .chart-container { background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.08); height: 70vh; }

        /* Footer */
        footer { background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); color: white; padding: 3rem 2rem 1rem; margin-top: 4rem; }
        .footer-container { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 3rem; margin-bottom: 2rem; }
        .footer-section h4 { font-size: 1.25rem; margin-bottom: 1rem; color: #4169E1; }
        .footer-section p { line-height: 1.8; color: #ccc; margin-bottom: 1rem; }
        .footer-logo { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .footer-logo h3 { font-size: 1.5rem; margin-bottom: 0.25rem; }
        .footer-logo p { font-size: 0.85rem; color: #999; margin: 0; }
        .footer-desc { color: #bbb; font-size: 0.95rem; }
        .footer-links { list-style: none; }
        .footer-links li { margin-bottom: 0.75rem; }
        .footer-links a { color: #ccc; text-decoration: none; transition: color 0.3s; }
        .footer-links a:hover { color: #4169E1; }
        .footer-contact { list-style: none; }
        .footer-contact li { margin-bottom: 0.75rem; color: #ccc; }
        .footer-bottom { max-width: 1400px; margin: 0 auto; padding-top: 2rem; border-top: 1px solid #444; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .footer-bottom p { color: #999; margin: 0; }
        .footer-bottom-links { display: flex; gap: 2rem; }
        .footer-bottom-links a { color: #999; text-decoration: none; font-size: 0.9rem; transition: color 0.3s; }
        .footer-bottom-links a:hover { color: #4169E1; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hamburger { display: flex; }
            .nav-links { position: absolute; top: 100%; left: 0; right: 0; background: white; flex-direction: column; padding: 1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: none; gap: 0.5rem; }
            .nav-links.active { display: flex; }
            .nav-link { width: 100%; justify-content: center; }
            .page-header h2 { font-size: 2rem; }
            .page-header p { font-size: 1rem; }
            .chart-container { height: 50vh; padding: 1rem; }
            .footer-container { grid-template-columns: 1fr; gap: 2rem; }
            .footer-bottom { flex-direction: column; text-align: center; }
            .footer-bottom-links { flex-direction: column; gap: 0.5rem; }
        }

        @media (max-width: 480px) {
            .logo-text h1 { font-size: 1.25rem; }
            .logo-text p { font-size: 0.75rem; }
            .page-header h2 { font-size: 1.75rem; }
            .chart-container { height: 40vh; padding: 1rem; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">‚ù§Ô∏è</div>
                <div class="logo-text"><h1>Pulse AI</h1><p>Advanced Medical Intelligence</p></div>
            </a>
            <div class="hamburger" onclick="toggleMenu()"><span></span><span></span><span></span></div>
            <div class="nav-links" id="navLinks">
                <a href="index.html" class="nav-link">‚ù§Ô∏è Home</a>
                <a href="mlprediction.html" class="nav-link">üß† Check Symptoms</a>
                <a href="dlprediction.html" class="nav-link">ü´Å Analyse Chest X-ray</a>
                <a href="aiassist.html" class="nav-link">üí¨ AI Assistant</a>
                <a href="trendchart.html" class="nav-link active">üìä Health Analytics</a>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <div class="page-header">
            <h2>Health Analytics Dashboard</h2>
            <p>Track changes and patterns in healthcare over time</p>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <canvas id="diagnosisTrendChart"></canvas>
            </div>
            
            <div class="chart-container">
                <canvas id="queryTopicsChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-section">
                <div class="footer-logo">
                    <div class="logo-icon">‚ù§Ô∏è</div>
                    <div>
                        <h3>Pulse AI</h3>
                        <p>Advanced Medical Intelligence</p>
                    </div>
                </div>
                <p class="footer-desc">
                    Transforming healthcare through artificial intelligence, providing cutting-edge solutions for medical professionals and patients worldwide.
                </p>
            </div>

            <div class="footer-section">
                <h4>About Us</h4>
                <p>Pulse AI is dedicated to revolutionizing healthcare with innovative AI-powered solutions. Our mission is to empower healthcare professionals with intelligent tools for accurate diagnosis, efficient patient care, and data-driven medical insights.</p>
            </div>

            <div class="footer-section">
                <h4>Contact</h4>
                <ul class="footer-contact">
                    <li>üìß muhammadakmaltp@gmail.com</li>
                </ul>
            </div>
        </div>

    </footer>

    <script>
        // Hamburger Menu Logic
        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }
        
        document.addEventListener('click', function(e) {
            const navLinks = document.getElementById('navLinks');
            const hamburger = document.querySelector('.hamburger');
            
            if (!navLinks.contains(e.target) && !hamburger.contains(e.target)) {
                navLinks.classList.remove('active');
            }
        });

        // This function runs when the page loads
        window.onload = function() {
            // It will now try to draw both charts
            fetchTrendDataAndDrawChart();
            fetchTopicsAndDrawChart();
        };

        // CHART 1
        async function fetchTrendDataAndDrawChart() {
            const ctx = document.getElementById('diagnosisTrendChart').getContext('2d');
            try {
                const response = await fetch('api/predict/trends');
                if (!response.ok) throw new Error('Failed to fetch trend data. Is the backend server running?');
                
                const trendData = await response.json();
                if (!trendData || trendData.labels.length === 0) {
                    ctx.font = "18px Arial"; ctx.fillStyle = "#666"; ctx.textAlign = "center";
                    ctx.fillText("No prediction data available yet. Make some predictions on the 'Check Symptoms' page first!", ctx.canvas.width / 2, 50);
                    return;
                }
                
                trendData.datasets.forEach(dataset => {
                    const colors = {"Flu": "#F97316", "Cold": "#4169E1", "Pneumonia": "#EF4444", "Bronchitis": "#9333EA", "Healthy": "#22C55E"};
                    dataset.borderColor = colors[dataset.label] || "#6B7280";
                    dataset.backgroundColor = (colors[dataset.label] || "#6B7280") + '33';
                });

                new Chart(ctx, {
                    type: 'line',
                    data: trendData,
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top', labels: { font: { size: 14 }}},
                            title: { display: true, text: 'Daily Diagnosis Predictions', font: { size: 20 }}
                        },
                        scales: {
                            x: { title: { display: true, text: 'Date', font: { size: 16, weight: 'bold' }}, ticks: { font: { size: 14 }}},
                            y: { title: { display: true, text: 'Number of Predictions', font: { size: 16, weight: 'bold' }}, beginAtZero: true, ticks: { precision: 0, font: { size: 14 }}}
                        }
                    }
                });
            } catch (error) {
                console.error("Failed to draw trend chart:", error);
                ctx.font = "16px Arial"; ctx.fillStyle = "red"; ctx.textAlign = "center";
                ctx.fillText(error.message, ctx.canvas.width / 2, 50);
            }
        }

        //  CHART 2 
        async function fetchTopicsAndDrawChart() {
            const ctx = document.getElementById('queryTopicsChart').getContext('2d');
            try {
                const response = await fetch('api/assistant/query_topics');
                if (!response.ok) throw new Error('Failed to fetch topic data from the server.');

                const topicData = await response.json();
                if (!topicData || topicData.labels.length === 0) {
                    ctx.font = "18px Arial"; ctx.fillStyle = "#666"; ctx.textAlign = "center";
                    ctx.fillText("No chatbot query data available yet. Ask the AI assistant some questions first!", ctx.canvas.width / 2, 50);
                    return;
                }

                new Chart(ctx, {
                    type: 'bar',
                    data: topicData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'Common Queries', font: { size: 20 } }
                        },
                        scales: {
                            x: { title: { display: true, text: 'Topics', font: { size: 16, weight: 'bold' }}, ticks: { font: { size: 14 }} },
                            y: { title: { display: true, text: 'Number of Queries', font: { size: 16, weight: 'bold' }}, beginAtZero: true, ticks: { precision: 0, font: { size: 14 }}}
                        }
                    }
                });
            } catch (error) {
                console.error("Failed to draw topics chart:", error);
                ctx.font = "16px Arial"; ctx.fillStyle = "red"; ctx.textAlign = "center";
                ctx.fillText(error.message, ctx.canvas.width / 2, 50);
            }
        }
    </script>
</body>
</html>